!function($){$.fn.ajaxDropDown=function(options){var set=$.extend(!0,{addc:"",dely:300,ercl:"",erst:"",hecl:"",hest:"",jsev:!0,keyt:!0,locl:"",lost:"",mabe:"",maen:"",minq:0,name:"ajaxDropDown",nebe:"",necl:"",neen:"",nest:"",nrcl:"",nrst:"",onrm:"",onsl:"",pabe:"",paen:"",prbe:"",prcl:"",pren:"",prst:"",prba:"",recl:"",rest:"",rmcl:"",rmla:"",rmst:"",rscl:"",rsst:"",smbt:!1,smod:!1,swcl:"",swst:"",url:"",loca:{allr:"All records",rcon:"Records containing",mcha:"Type at least {NUM} character(s) to filter the results...",erro:"Error",prev:"prev",next:"next",nrec:"No matching records found"}},options),accl="active",ajRec=" ajaxDropDownRecord",ali="</a></li>",aNext="a.ajaxDropDownNext",aPrev="a.ajaxDropDownPrev",buttSR="button.ajaxDropDownSingleRemove",buttTogg="button.ajaxDropDownToggle",dataId='><a href="#" class="ajaxDropDownResult" data-id="',dicl="disabled",hicl="hidden",inpTxt="input[type=text]",li="</li>",lih='<li class="dropdown-header',liPage="li.ajaxDropDownPage",liPages="li.ajaxDropDownPages",liPagesAll='<li class="ajaxDropDownPages ajaxDropDownPage',liSel="li.ajaxDropDownSelected",spNum="span.ajaxDropDownPageNumber",st=' style="',ulMenu="ul.ajaxDropDownMenu",timeOut=null,selection=[],onRemove=new Function("id","selection",set.onrm),onSelect=new Function("id","label","selection",set.onsl),rearrange=function(a){var b=[];for(var c in selection)selection[c].id!=a&&b.push(selection[c]);selection=b},isin=function(a){for(var b in selection)if(selection[b].id==a)return!0;return!1},res=this.find("ul.ajaxDropDownResults"),rem=this.find(buttSR),ul=this.find(ulMenu),tx=this.find(inpTxt),bt=this.find(buttTogg),btns=this.find("div.ajaxDropDownButtons"),prba='<li class="ajaxDropDownLoading',getAdditionalPostData=[];""!==set.locl&&(prba+=" "+set.locl),prba+='"',""!==set.lost&&(prba+=st+set.lost+'"'),prba+=">"+set.prba+li;var headerStart=lih;""!==set.hecl&&(headerStart+=" "+set.hecl),headerStart+='"',""!==set.hest&&(headerStart+=st+set.hest+'"'),headerStart+=">";var headerMinimumCharacters=set.loca.mcha.replace(/{NUM}/g,set.minq),erro=lih;""!==set.ercl&&(erro+=" "+set.ercl),erro+='"',""!==set.erst&&(erro+=st+set.erst+'"'),erro+=">"+set.loca.erro+li;var nrec=lih;""!==set.nrcl&&(nrec+=" "+set.nrcl),nrec+='"',""!==set.nrst&&(nrec+=st+set.nrst+'"'),nrec+=">"+set.loca.nrec+li;var loadData=function(){if(0===ul.find(liPages).length){var page=bt.data("page");page*=1;var search=!1,hst=headerStart+set.pabe+'<span class="ajaxDropDownPageNumber">'+page+'</span>/<span class="ajaxDropDownTotalPages">1</span>',header=hst;header+=set.paen+set.loca.allr+'</li><li class="divider"></li>'+prba;var query=tx.val();if(query.length>0?query.length>=set.minq?(header=hst,header+=set.paen+set.loca.rcon+" <strong>"+query,header+='</strong></li><li class="divider"></li>'+prba,search=!0):header=headerStart+headerMinimumCharacters+li:search=!0,ul.html(header),search){var additionalPostData=[];eval("additionalPostData = "+set.getAdditionalPostData),additionalPostData[0].query=query,additionalPostData[0].page=page,$.post(set.url,additionalPostData[0]).fail(function(){ul.append(erro),console.log("jQuery post failed")}).done(function(a){var b=$.parseJSON(a);if(void 0===b.total&&(b.total=1),void 0===b.page&&(b.page=1),void 0===b.data)ul.append(erro),console.log("No data element in results object",a);else if(b.data.length){ul.find("span.ajaxDropDownTotalPages").text(b.total);for(var c in b.data){var d=liPagesAll+b.page+ajRec+b.data[c].id;""!==set.recl&&(d+=" "+set.recl),ul.parent().parent().parent().find(liSel+b.data[c].id).length&&(d+=" "+accl),d+='"',""!==set.rest&&(d+=st+set.rest+'"'),d+=dataId+b.data[c].id+'">',b.data[c].mark&&(d+=set.mabe),d+=b.data[c].value,b.data[c].mark&&(d+=set.maen),d+=ali,ul.append(d)}if(b.total>1){var e='<li class="divider ajaxDropDownInfo"></li><li class="ajaxDropDownInfo';""!==set.swcl&&(e+=" "+set.swcl),e+='"',""!==set.swst&&(e+=st+set.swst+'"'),e+='><a href="#" class="ajaxDropDownPrev',""!==set.prcl&&(e+=" "+set.prcl),1===b.page&&(e+=" "+dicl),e+='"',""!==set.prst&&(e+=st+set.prst+'"'),e+=">"+set.prbe+set.loca.prev+set.pren+'</a><a href="#" class="ajaxDropDownNext',""!==set.necl&&(e+=" "+set.necl),b.page===b.total&&(e+=" "+dicl),e+='"',""!==set.nest&&(e+=st+set.nest+'"'),e+=">"+set.nebe+set.loca.next+set.neen+ali,ul.append(e)}}else ul.append(nrec)}).always(function(){$("li.ajaxDropDownLoading").remove()})}}};return this.on("show.bs.dropdown",loadData),this.on("click",aNext,function(e){e.preventDefault(),e.stopPropagation(),ul.find(aPrev).removeClass(dicl),ul.find(aNext).addClass(dicl);var page=bt.data("page");if(page=1*page+1,ul.find(liPage+page).length)ul.find(liPages).addClass(hicl),ul.find(liPage+page).removeClass(hicl),ul.find(aNext).removeClass(dicl);else{var query=tx.val(),additionalPostData=[];eval("additionalPostData = "+set.getAdditionalPostData),additionalPostData[0].query=query,additionalPostData[0].page=page,$.post(set.url,additionalPostData[0]).fail(function(){ul.append(erro),console.log("jQuery post failed")}).done(function(a){var b=$.parseJSON(a);if(void 0===b.data)ul.append(erro),console.log("No data element in results object",a);else if(b.data.length){ul.find(liPages).addClass(hicl),void 0===b.total&&(b.total=1),void 0===b.page&&(b.page=1);for(var c in b.data){var d=liPagesAll+b.page+ajRec+b.data[c].id;""!==set.recl&&(d+=" "+set.recl),ul.parent().parent().parent().find(liSel+b.data[c].id).length&&(d+=" "+accl),d+='"',""!==set.rest&&(d+=st+set.rest+'"'),d+=dataId+b.data[c].id+'">',b.data[c].mark&&(d+=set.mabe),d+=b.data[c].value,b.data[c].mark&&(d+=set.maen),d+=ali,ul.find(".divider.ajaxDropDownInfo").before(d)}b.page<b.total?ul.find(aNext).removeClass(dicl):page=b.total}else ul.append(nrec)})}bt.data("page",page),ul.find(spNum).text(page)}),this.on("click",aPrev,function(a){a.preventDefault(),a.stopPropagation(),ul.find(aNext).removeClass(dicl),ul.find(aPrev).addClass(dicl);var b=bt.data("page");b=1*b-1,b<1&&(b=1),ul.find(liPages).addClass(hicl),ul.find(liPage+b).removeClass(hicl),b>1&&ul.find(aPrev).removeClass(dicl),bt.data("page",b),ul.find(spNum).text(b)}),this.on("keyup",inpTxt,function(){window.clearTimeout(timeOut),$(this).parent().find(buttTogg).data("page",1),$(this).parent().find(ulMenu).find(liPages).remove(),set.keyt&&(timeOut=window.setTimeout(function(){btns.addClass("open"),loadData()},set.dely))}),this.on("click","a.ajaxDropDownResult",function(a){a.preventDefault();var b=$(this).data("id"),c=$(this).html(),d="[]";if(set.smod&&(res.html(""),selection=[],$(this).parent().parent().find(liPages).removeClass(accl),d=""),set.smod&&""===set.addc&&!set.smbt)bt.hide(),rem.show(),tx.val(c.replace(/<.*?>/g,"").replace(/"/g,"'")),tx.prop("disabled",!0),tx.parent().find(".singleResult").length?tx.parent().find(".singleResult").val(b):tx.after('<input class="singleResult" type="hidden" name="'+set.name+'" value="'+b+'">'),selection.push({id:b,label:c}),onSelect(b,c,selection);else if($(this).parent().hasClass(accl))$(this).parent().removeClass(accl),res.find(liSel+b).remove(),rearrange(b),onRemove(b,selection);else{$(this).parent().addClass(accl);var e='<li class="ajaxDropDownSelected'+b;if(""!==set.rscl&&(e+=" "+set.rscl),e+='"',""!==set.rsst&&(e+=st+set.rsst+'"'),e+='><a href="#" class="ajaxDropDownRemove',""!==set.rmcl&&(e+=" "+set.rmcl),e+='"',""!==set.rmst&&(e+=st+set.rmst+'"'),e+=' data-id="'+b+'">'+set.rmla+"</a>",""!==set.addc){var f=set.addc.replace(/{ID}/g,b);f=f.replace(/{VALUE}/g,c),e+=f}e+=c+'<input type="hidden" name="'+set.name+d+'" value="'+b+'"></li>',res.append(e),selection.push({id:b,label:c}),onSelect(b,c,selection)}}),this.on("click","a.ajaxDropDownRemove",function(a){a.preventDefault();var b=$(this).data("id");$(this).parent().parent().parent().find("li.ajaxDropDownRecord"+b).removeClass(accl),$(this).parent().remove(),rearrange(b),onRemove(b,selection)}),this.on("click",buttSR,function(a){a.preventDefault();var b=$(this).parent().parent().find("input.singleResult"),c=b.val();b.remove(),tx.prop("disabled",!1),tx.val(""),$(this).hide(),bt.show(),rearrange(c),onRemove(c,selection)}),this.on("add",function(){var a="[]",b="";set.smod&&(res.html(""),selection=[],a="");for(var c in arguments)if(0!=c)if(void 0===arguments[c].id)console.log("No id element in data object",arguments[c]);else{var d=arguments[c].id;if(!isin(d)){var e="";void 0!==arguments[c].value&&(e=arguments[c].value);var f=0;1==arguments[c].mark&&(f=1),f&&(e=set.mabe+e+set.maen);var g=set.addc;if(arguments[c].additional===!1?g="":void 0!==arguments[c].additional&&(g=arguments[c].additional),set.smod&&""===set.addc&&!set.smbt)bt.hide(),rem.show(),tx.val(e.replace(/<.*?>/g,"").replace(/"/g,"'")),tx.prop("disabled",!0),tx.parent().find(".singleResult").length?tx.parent().find(".singleResult").val(d):tx.after('<input class="singleResult" type="hidden" name="'+set.name+'" value="'+d+'">'),selection.push({id:d,label:e}),set.jsev&&onSelect(d,e,selection);else{var b='<li class="ajaxDropDownSelected'+d;if(""!==set.rscl&&(b+=" "+set.rscl),b+='"',""!==set.rsst&&(b+=st+set.rsst+'"'),b+='><a href="#" class="ajaxDropDownRemove',""!==set.rmcl&&(b+=" "+set.rmcl),b+='"',""!==set.rmst&&(b+=st+set.rmst+'"'),b+=' data-id="'+d+'">'+set.rmla+"</a>",""!==g){var h=g.replace(/{ID}/g,d);h=h.replace(/{VALUE}/g,e),b+=h}b+=e+'<input type="hidden" name="'+set.name+a+'" value="'+d+'"></li>',set.smbt||(res.append(b),selection.push({id:d,label:e}),set.jsev&&onSelect(d,e,selection))}}}set.smbt&&""!==b&&(res.append(b),selection.push({id:d,label:e}),set.jsev&&onSelect(d,e,selection))}),this.on("removeOne",function(){for(var a in arguments)if(0!=a)if(isNaN(arguments[a]))console.log("id is not a number",arguments[a]);else{var b=arguments[a];isin(b)&&(res.find(liSel+b).remove(),rearrange(b),set.jsev&&onRemove(b,selection))}}),this.on("removeAll",function(){res.html(""),selection=[]}),this}}(jQuery);